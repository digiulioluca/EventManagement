<div class="booking-container container my-5">

  <!-- Loading -->
  <div *ngIf="isLoading" class="loading">Caricamento eventi...</div>

    <!-- Vista lista eventi -->
    <div *ngIf="!editMode && !addMode && !event">

      <h2 class="text-center mb-4">
        {{ eventsState ? 'ğŸ‰ Eventi correnti' : 'ğŸ“… Eventi conclusi' }}
      </h2>

      <ul class="reservation-list">
        <li
          *ngFor="let ev of events"
          class="reservation-item"
          [class.disabled]="ev.state !== eventsState"
          (click)="selectEvent(ev)"
          style="cursor: pointer;"
        >
          <h5 class="mb-2 text-uppercase">{{ ev.title }}</h5>
          <p><strong>ğŸ“ Luogo:</strong> {{ ev.location }}</p>
          <p><strong>ğŸ“… Data evento:</strong> {{ ev.date | date : 'dd/MM/yyyy' }}</p>
        </li>
      </ul>

      <div class="d-flex justify-content-between mt-3">
        <button
          class="btn btn-sm"
          style="background-color: #ac8905; color: white;"
          (click)="eventsState = !eventsState"
        >
          {{ eventsState ? 'Mostra eventi conclusi' : 'Mostra eventi correnti' }}
        </button>
        <button
          class="btn btn-sm"
          style="background-color: #fcc902; color: #0c0b0b;"
          (click)="addEvent()"
        >
          <i class="bi bi-plus-circle"></i> Aggiungi nuovo evento
        </button>
      </div>
    </div>

    <!-- Vista dettaglio evento -->
    <div *ngIf="event && !editMode && !addMode" class="reservation-item">
      <h3 class="mb-3 text-uppercase">{{ event.title }}</h3>
      <p><strong>Descrizione:</strong> {{ event.description }}</p>
      <p><strong>ğŸ“… Data:</strong> {{ event.date | date : 'dd/MM/yyyy' }}</p>
      <p><strong>ğŸ“ Location:</strong> {{ event.location }}</p>
      <p><strong>ğŸŸï¸ Posti totali:</strong> {{ event.totalSeats }}</p>
      <p><strong>ğŸ’º Posti liberi:</strong> {{ event.availableSeats }}</p>
      <p><strong>ğŸ“Œ Stato:</strong> {{ event.state ? 'Da svolgersi' : 'Terminato' }}</p>
      <p><strong>ğŸ·ï¸ Categoria:</strong> {{ event.eventCategory }}</p>

      <div class="d-flex justify-content-between mt-3">
        <button
          *ngIf="event.state"
          class="btn btn-sm"
          style="background-color: #fcc902; color: #0c0b0b;"
          (click)="enableEdit()"
        >
          <i class="bi bi-pencil-square"></i> Modifica
        </button>

        <button
          class="btn btn-sm"
          style="background-color: #ac8905; color: white;"
          (click)="deleteEvent()"
        >
          <i class="bi bi-trash3"></i> Elimina
        </button>

        <button
          class="btn btn-sm"
          style="background-color: #5c4a08; color: white;"
          (click)="event = null"
        >
          <i class="bi bi-x-circle"></i> Annulla
        </button>
      </div>
    </div>

    <!-- Form modifica evento -->
    <div *ngIf="editMode && editableEvent" class="reservation-item">
      <h3 class="mb-3 text-uppercase">Modifica: {{ editableEvent.title }}</h3>
      <form (ngSubmit)="saveEdit()">
        <label>
          Titolo:
          <input [(ngModel)]="editableEvent.title" name="title" required />
        </label>
        <label>
          Descrizione:
          <input [(ngModel)]="editableEvent.description" name="description" />
        </label>
        <label>
          Data:
          <input type="date" [(ngModel)]="editableEvent.date" name="date" />
        </label>
        <label>
          Location:
          <input [(ngModel)]="editableEvent.location" name="location" />
        </label>
        <label>
          Posti totali:
          <input type="number" [(ngModel)]="editableEvent.totalSeats" name="totalSeats" />
        </label>
        <label>
          Posti liberi:
          <input type="number" [(ngModel)]="editableEvent.availableSeats" name="availableSeats" />
        </label>
        <label>
          Stato:
          <input type="checkbox" [(ngModel)]="editableEvent.state" name="state" /> Da svolgersi
        </label>
        <label>
          Categoria:
          <select [(ngModel)]="editableEvent.eventCategory" name="eventCategory">
            <option *ngFor="let cat of eventCategories" [value]="cat">{{ cat }}</option>
          </select>
        </label>

        <div class="d-flex justify-content-between mt-3">
          <button type="submit" class="btn btn-sm" style="background-color: #fcc902; color: #0c0b0b;">
            <i class="bi bi-save"></i> Salva
          </button>
          <button type="button" class="btn btn-sm" style="background-color: #5c4a08; color: white;" (click)="cancelEdit()">
            <i class="bi bi-x-circle"></i> Annulla
          </button>
          <button type="button" class="btn btn-sm" style="background-color: #ac8905; color: white;" (click)="deleteEvent()">
            <i class="bi bi-trash3"></i> Elimina
          </button>
        </div>
      </form>
    </div>

    <!-- Form aggiungi evento -->
    <div *ngIf="addMode && newEvent" class="reservation-item">
      <h3 class="mb-3 text-uppercase">Nuovo Evento</h3>
      <form (ngSubmit)="saveNewEvent()">
        <label>
          Titolo:
          <input [(ngModel)]="newEvent.title" name="title" required />
        </label>
        <label>
          Descrizione:
          <input [(ngModel)]="newEvent.description" name="description" />
        </label>
        <label>
          Data:
          <input type="date" [(ngModel)]="newEvent.date" name="date" />
        </label>
        <label>
          Location:
          <input [(ngModel)]="newEvent.location" name="location" />
        </label>
        <label>
          Posti totali:
          <input type="number" [(ngModel)]="newEvent.totalSeats" name="totalSeats" />
        </label>
        <label>
          Categoria:
          <select [(ngModel)]="newEvent.eventCategory" name="eventCategory">
            <option *ngFor="let cat of eventCategories" [value]="cat">{{ cat }}</option>
          </select>
        </label>

        <div class="d-flex justify-content-between mt-3">
          <button type="submit" class="btn btn-sm" style="background-color: #fcc902; color: #0c0b0b;">
            <i class="bi bi-save"></i> Salva
          </button>
          <button type="button" class="btn btn-sm" style="background-color: #5c4a08; color: white;" (click)="cancelAdd()">
            <i class="bi bi-x-circle"></i> Annulla
          </button>
        </div>
      </form>
    </div>

  </div>
