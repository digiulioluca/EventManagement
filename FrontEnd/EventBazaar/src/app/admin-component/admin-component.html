<!-- Mostra messaggio di caricamento mentre isLoading è true -->
<div *ngIf="isLoading">Caricamento eventi</div>

<!-- Contenuto principale quando il caricamento è finito -->
<div *ngIf="!isLoading">

  <!-- Se NON siamo in modalità modifica né aggiunta -->
  <div *ngIf="!editMode && !addMode">

    <!-- Titolo che cambia in base a eventsState e se non è selezionato nessun evento -->
    <h2 *ngIf="!event ">
      {{ eventsState ? 'Eventi correnti' : 'Eventi conclusi' }}
    </h2>

    <!-- Lista eventi filtrata per stato (correnti o conclusi) -->
    <ul *ngIf="!event && events.length > 0; else noEvents">
      <ng-container *ngFor="let event of events">
        <li *ngIf="event.state === eventsState" (click)="selectEvent(event)">
          <strong>{{event.title}}</strong>
          <br>
          {{event.location}}
          <br>
          <!-- Data formattata gg/mm/aaaa -->
          {{event.date | date : 'dd/MM/yyyy'}}
        </li>
      </ng-container>
    </ul>

    <!-- Pulsanti per cambiare vista eventi e aggiungere un nuovo evento -->
    <p *ngIf="!event">
      <!-- Bottone per passare tra eventi correnti e conclusi -->
      <button (click)="eventsState = !eventsState">
        {{ eventsState ? 'Eventi conclusi' : 'Indietro' }}
      </button>

      <!-- Bottone per entrare nella modalità di aggiunta evento -->
      <button (click)="addEvent()">Aggiungi nuovo evento</button>
    </p>

    <!-- Template alternativo se non ci sono eventi -->
    <ng-template #noEvents>
      <p *ngIf="!editMode && !event">Nessun evento</p>
    </ng-template>

    <!-- Visualizzazione dettagli evento selezionato -->
    <div *ngIf="event">
      <h2>{{event.title}}</h2>
      <p><strong>Titolo:</strong> {{event.title}}</p>
      <p><strong>Descrizione:</strong> {{event.description}}</p>
      <p><strong>Data:</strong> {{event.date | date : 'dd/MM/yyyy'}}</p>
      <p><strong>Location:</strong> {{event.location}}</p>
      <p><strong>Posti totali:</strong> {{event.totalSeats}}</p>
      <p><strong>Posti liberi:</strong> {{event.availableSeats}}</p>
      <p><strong>Stato:</strong> {{ event.state ? 'Da svolgersi' : 'Terminato' }}</p>
      <p><strong>Categoria:</strong> {{event.eventCategory}}</p>

      <!-- Pulsanti per modificare (solo se evento attivo), eliminare o annullare selezione -->
      <button *ngIf="event.state" (click)="enableEdit()">Modifica</button>
      <button (click)="deleteEvent()">Elimina</button>
      <button (click)="event = null">Annulla</button>
    </div>
  </div>

  <!-- Form di modifica evento -->
  <div *ngIf="editMode && editableEvent">
    <h2>{{editableEvent.title}}</h2>
    <p>
      <strong>Titolo:</strong>
      <input [(ngModel)]="editableEvent.title">
    </p>
    <p>
      <strong>Descrizione:</strong>
      <input [(ngModel)]="editableEvent.description">
    </p>
    <p>
      <strong>Data:</strong>
      <input type="date" [(ngModel)]="editableEvent.date">
    </p>
    <p>
      <strong>Location:</strong>
      <input [(ngModel)]="editableEvent.location">
    </p>
    <p>
      <strong>Posti totali:</strong>
      <input [(ngModel)]="editableEvent.totalSeats">
    </p>
    <p>
      <strong>Posti liberi:</strong>
      <input [(ngModel)]="editableEvent.availableSeats">
    </p>
    <p>
      <strong>Stato:</strong>
      {{ editableEvent.state ? 'Da svolgersi' : 'Terminato' }}
      <input type="checkbox" [(ngModel)]="editableEvent.state"> Cambia stato
    </p>
    <p>
      <strong>Categoria:</strong>
      <select [(ngModel)]="editableEvent.eventCategory">
        <option *ngFor="let cat of eventCategories" [value]="cat">{{cat}}</option>
      </select>
    </p>
    <button (click)="saveEdit()">Salva</button>
    <button (click)="cancelEdit()">Annulla</button>
    <button (click)="deleteEvent()">Elimina</button>
  </div>

  <!-- Form per aggiungere un nuovo evento -->
  <div *ngIf="addMode && newEvent">
    <h2>Nuovo Evento</h2>
    <p>
      <strong>Titolo:</strong> <input [(ngModel)]="newEvent.title">
    </p>
    <p>
      <strong>Descrizione:</strong> <input [(ngModel)]="newEvent.description">
    </p>
    <p>
      <strong>Data:</strong> <input type="date" [(ngModel)]="newEvent.date">
    </p>
    <p>
      <strong>Location:</strong> <input [(ngModel)]="newEvent.location">
    </p>
    <p>
      <strong>Posti totali:</strong> <input [(ngModel)]="newEvent.totalSeats" type="number">
    </p>
    <p>
      <strong>Categoria:</strong>
      <select [(ngModel)]="newEvent.eventCategory">
        <option *ngFor="let cat of eventCategories" [value]="cat">{{cat}}</option>
      </select>
    </p>

    <button (click)="saveNewEvent()">Salva</button>
    <button (click)="cancelAdd()">Annulla</button>
  </div>
</div>
